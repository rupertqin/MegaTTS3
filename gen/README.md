# 音频生成使用说明

## 功能说明

该工具会自动将文本按句子分段，每个句子生成一个独立的音频文件和对应的 SRT 字幕文件，然后可以合并成完整音频和字幕。

## 使用方法

### 1. 完整流程（生成 + 合并）

```bash
./gen.sh
# 或
./gen.sh both
```

这会：

1. 读取 `gen/speech.txt` 中的文本
2. 自动按句子分段（中文按标点符号，英文按句子）
3. 为每个句子生成独立的音频文件
4. 为每个音频生成对应的 SRT 字幕文件
5. 自动合并所有音频文件
6. 生成合并的 SRT 字幕文件

### 2. 仅生成音频

```bash
./gen.sh generate
```

只生成音频文件，不合并。适合：

- 想先检查单个句子的音频质量
- 分批生成，避免一次性占用太多资源

### 3. 仅合并音频和生成字幕

```bash
./gen.sh merge
```

根据 `generation_report.json` 合并已生成的音频文件，并生成所有 SRT 字幕文件。适合：

- 已经生成了所有音频，只需要合并和生成字幕
- 重新合并（会生成新的合并文件，不会重复合并旧的）

### 4. 仅生成 SRT 字幕

```bash
./gen.sh srt
```

根据 `generation_report.json` 和已有音频文件生成 SRT 字幕。适合：

- 已有音频文件，只需要生成字幕
- 重新生成字幕文件

## 文件说明

- `speech.txt` - 输入文本文件
- `audio/` - 输出目录
  - `001_完整句子文本.wav`, `002_完整句子文本.wav` ... - 按句子生成的音频文件（文件名包含完整文本内容）
  - `001_完整句子文本.srt`, `002_完整句子文本.srt` ... - 对应的 SRT 字幕文件
  - `merged_audio_<timestamp>.wav` - 合并后的完整音频
  - `merged_subtitles.srt` - 合并后的完整字幕文件
  - `generation_report.json` - 生成报告，记录所有句子和对应的音频文件

### 文件命名规则

音频和字幕文件名格式：`序号_完整文本内容.wav` / `序号_完整文本内容.srt`

例如：

- `001_现在的女性关系越来越多元化什么轻关系开放式关系性缘脑是不是觉得太开放了.wav`
- `001_现在的女性关系越来越多元化什么轻关系开放式关系性缘脑是不是觉得太开放了.srt`
- `002_通常我们觉得好像只有男人才想着到处播种女人天生就喜欢从一而终.wav`
- `002_通常我们觉得好像只有男人才想着到处播种女人天生就喜欢从一而终.srt`

特点：

- 文件名包含完整句子内容（去除标点符号）
- 音频和字幕文件名一一对应
- 直观易读，便于查找和管理
- 不使用哈希，避免冲突

## 特性

1. **智能分句**：自动识别中英文，按合适的标点符号分句
2. **增量生成**：已存在的音频文件会自动跳过，不会重复生成
3. **精确合并**：根据 JSON 报告合并，确保顺序正确，不会重复合并已合并的文件
4. **进度追踪**：显示详细的生成进度和时间统计
5. **字幕同步**：自动生成与音频完全同步的 SRT 字幕文件
6. **时间精确**：字幕时间轴精确到毫秒，包含静音间隔

## 参数调整

编辑 `gen.sh` 可以调整：

- `p_w`：清晰度权重（1.0-3.0，越大越标准化）
- `t_w`：相似度权重（2.0-5.0，越大越接近参考音色）
- `--merge_gap`：合并时句子间的静音间隔（毫秒）
