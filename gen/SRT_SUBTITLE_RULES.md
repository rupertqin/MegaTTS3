# SRT 字幕分句规则

## 分句逻辑

### 1. 按标点符号分割

按以下标点符号分割文本：

- 中文标点：，。！？；：、
- 英文标点：, . ! ? ; :

### 2. 长度限制

- **最大长度**：15 个字符
- **最小长度**：10 个字符

### 3. 智能合并

- 如果分割后的片段少于 10 个字，自动与相邻片段合并
- 优先向后合并（与下一个片段合并）
- 如果向后合并会超过 15 字，则保持原状
- 最后再向前合并（与上一个片段合并）

### 4. 去除末尾标点

- 所有字幕行自动去除末尾的标点符号
- 保持文本简洁清晰

## 示例

### 示例 1：正常分句

```
原文：最近有个传闻在网上闹得沸沸扬扬，说康熙皇帝可能是个汉人。

分割结果：
1. 最近有个传闻在网上闹得沸沸扬扬 (15字)
2. 说康熙皇帝可能是个汉人 (11字)
```

### 示例 2：短句合并

```
原文：这是第一句，这是第二句，这是第三句。

分割结果：
1. 这是第一句这是第二句这是第三句 (15字)
   (三个短句合并成一行)
```

### 示例 3：长句分割

```
原文：连最高统治者都要面对这种焦虑，更别提普通人了。看看现在，随着亲子鉴定技术的普及，多少现代婚姻的遮羞布被扯了下来。

分割结果：
1. 连最高统治者都要面对这种焦虑 (14字)
2. 更别提普通人了看看现在 (11字)
3. 随着亲子鉴定技术的普及 (11字)
4. 多少现代婚姻的遮羞布被扯了下来 (15字)
```

## 优势

1. **避免过短字幕**：少于 10 字的片段会自动合并，避免一闪而过
2. **保持可读性**：每行不超过 15 字，观众有足够时间阅读
3. **自然断句**：按标点符号分割，符合语言习惯
4. **简洁清晰**：去除末尾标点，视觉更整洁

## 调整参数

如果需要调整分句规则，可以修改 `incremental_tts_generator.py` 中的参数：

```python
def split_subtitle_text(text, max_chars=15, min_chars=10):
    # max_chars: 每行最大字符数
    # min_chars: 每行最小字符数
    ...
```

### 建议参数范围

- **max_chars**: 12-20 字符

  - 12-15: 适合手机屏幕
  - 15-18: 适合电脑屏幕
  - 18-20: 适合大屏幕

- **min_chars**: 8-12 字符
  - 8-10: 更多分句，节奏快
  - 10-12: 适中
  - 12+: 更少分句，节奏慢

## 特殊情况处理

### 1. 非常短的文本

```
原文：短句子 (3字)

结果：短句子 (3字)
(保持原样，不强制合并)
```

### 2. 超长无标点文本

```
原文：这是一个非常非常非常非常非常长的句子没有任何标点符号

结果：
1. 这是一个非常非常非常 (10字)
2. 非常非常长的句子没 (10字)
3. 有任何标点符号 (7字，与前一行合并失败则保留)
```

### 3. 最后一行过短

如果最后一行少于 10 字且无法与前一行合并（前一行已达 15 字），则保留该短行。这是可接受的，因为是结尾。

## 实际效果

使用这套规则生成的字幕：

- ✅ 每行 10-15 字，阅读舒适
- ✅ 自然断句，符合语言习惯
- ✅ 避免过短字幕一闪而过
- ✅ 视觉简洁，无多余标点
- ✅ 时间轴精确，与音频同步
